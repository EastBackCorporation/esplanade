<%= form_for(@comment) do |f| %>
  <% if @comment.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@comment.errors.count, "error") %> prohibited this comment from being saved:</h2>

      <ul>
      <% @comment.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
    <%= f.hidden_field :topic_id %>
    <%= f.hidden_field :user_id %>
  <form class="form-horizontal">
    <span class="label label-default"><%= @username %></span>
    <fieldset>
      <div class="form-group">
        <div class="col-lg-10">
          <%= f.text_area :value, class: "form-control", rows: "3" %>
        </div>
      </div>
      <div class="form-group">
        <% if @comment.image? %>
        <div class="thumbnail">
          <%= image_tag @comment.image.url %>
        </div>
        <% end %><br>
        <div class="btn btn-default" onclick="document.getElementById('comment_image').click()">画像</div>
        <img src="" id="preview" width="50px">
        <div hidden="hidden" onchange="reader=new FileReader();file=document.getElementById('comment_image');f=file.files;reader.readAsDataURL(f[0]);reader.onload =(function(){$('#preview').attr('src',reader.result);});"><%= f.file_field :image %></div>
        <%= f.hidden_field :image_cache %>
      </div>
      <div class="from-group">
        <% if @comment.persisted? && @comment.image? %>
        <label>
          <%= f.check_box :remove_image %>remove
        </label>
        <% end %>
      </div>

      <div class="from-group">
        <div class="pull-right">
          <%= f.submit "投稿", class: "btn btn-primary"%>
        </div>
      </div>
    </fieldset>
    </form>
<% end %>
